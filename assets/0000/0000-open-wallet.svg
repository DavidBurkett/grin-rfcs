<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="769px" preserveAspectRatio="none" style="width:910px;height:769px;" version="1.1" viewBox="0 0 910 769" width="910px" zoomAndPan="magnify"><defs><filter height="300%" id="fczcr9unt7m9t" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="29" x2="29" y1="86.7999" y2="681.8001"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="381.5" x2="381.5" y1="86.7999" y2="681.8001"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="539.5" x2="539.5" y1="86.7999" y2="681.8001"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="728" x2="728" y1="86.7999" y2="681.8001"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="8" y="83.0059">Client</text><ellipse cx="29" cy="13" fill="#FEFECE" filter="url(#fczcr9unt7m9t)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M29,21 L29,48 M16,29 L42,29 M29,48 L16,63 M29,48 L42,63 " fill="none" filter="url(#fczcr9unt7m9t)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="8" y="693.8061">Client</text><ellipse cx="29" cy="707.6001" fill="#FEFECE" filter="url(#fczcr9unt7m9t)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M29,715.6001 L29,742.6001 M16,723.6001 L42,723.6001 M29,742.6001 L16,757.6001 M29,742.6001 L42,757.6001 " fill="none" filter="url(#fczcr9unt7m9t)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fczcr9unt7m9t)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="296.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="303.5" y="71.0059">JSON-RPC API (if used)</text><rect fill="#FEFECE" filter="url(#fczcr9unt7m9t)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="296.5" y="680.8001"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="303.5" y="700.8061">JSON-RPC API (if used)</text><rect fill="#FEFECE" filter="url(#fczcr9unt7m9t)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="477.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="484.5" y="71.0059">Internal Rust API</text><rect fill="#FEFECE" filter="url(#fczcr9unt7m9t)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="477.5" y="680.8001"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="484.5" y="700.8061">Internal Rust API</text><rect fill="#FEFECE" filter="url(#fczcr9unt7m9t)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="670" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="677" y="71.0059">Wallet Backend</text><rect fill="#FEFECE" filter="url(#fczcr9unt7m9t)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="670" y="680.8001"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="677" y="700.8061">Wallet Backend</text><rect fill="#EEEEEE" filter="url(#fczcr9unt7m9t)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="895" x="3" y="117.5999"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="898" y1="117.5999" y2="117.5999"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="898" y1="120.5999" y2="120.5999"/><rect fill="#EEEEEE" filter="url(#fczcr9unt7m9t)" height="23.6" style="stroke: #000000; stroke-width: 2.0;" width="93" x="404" y="106.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="410" y="122.8769">Open Wallet</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="71" y1="162" y2="162"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71" x2="71" y1="162" y2="175"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="71" y1="175" y2="175"/><polygon fill="#A80036" points="40,171,30,175,40,179,36,175" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="36" y="156.477">Encrypt password (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="148" y="156.477">pw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="166" y="156.477">) with DH shared secret</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="306" y="156.477">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="317" y="156.477">-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42" x="333" y="156.477">pwEnc</text><polygon fill="#A80036" points="370,200.6,380,204.6,370,208.6,374,204.6" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="376" y1="204.6" y2="204.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="36" y="199.077">Open Wallet (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42" x="115" y="199.077">pwEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="157" y="199.077">)</text><polygon fill="#A80036" points="528,230.2,538,234.2,528,238.2,532,234.2" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="534" y1="234.2" y2="234.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="389" y="228.677">Open Wallet (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42" x="468" y="228.677">pwEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="510" y="228.677">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="540" x2="582" y1="263.8" y2="263.8"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="582" x2="582" y1="263.8" y2="276.8"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="541" x2="582" y1="276.8" y2="276.8"/><polygon fill="#A80036" points="551,272.8,541,276.8,551,280.8,547,276.8" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="547" y="258.277">Decrypt (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42" x="600" y="258.277">pwEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="642" y="258.277">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="650" y="258.277">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="657" y="258.277">) -&gt; (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="685" y="258.277">pw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="258.277">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="540" x2="582" y1="306.4" y2="306.4"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="582" x2="582" y1="306.4" y2="319.4"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="541" x2="582" y1="319.4" y2="319.4"/><polygon fill="#A80036" points="551,315.4,541,319.4,551,323.4,547,319.4" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="547" y="300.877">Generate Token (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="648" y="300.877">t</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="652" y="300.877">)</text><polygon fill="#A80036" points="716,345,726,349,716,353,720,349" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="540" x2="722" y1="349" y2="349"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="547" y="343.477">Open Wallet(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="622" y="343.477">t</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="626" y="343.477">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="634" y="343.477">pw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="652" y="343.477">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="728" x2="770" y1="378.6" y2="378.6"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="770" x2="770" y1="378.6" y2="391.6"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="729" x2="770" y1="391.6" y2="391.6"/><polygon fill="#A80036" points="739,387.6,729,391.6,739,395.6,735,391.6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="735" y="373.077">Decrypt seed(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="816" y="373.077">pw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="834" y="373.077">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="858" y="373.077">Seed</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="728" x2="770" y1="421.2001" y2="421.2001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="770" x2="770" y1="421.2001" y2="434.2001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="729" x2="770" y1="434.2001" y2="434.2001"/><polygon fill="#A80036" points="739,430.2001,729,434.2001,739,438.2001,735,434.2001" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="735" y="415.677">Store Seed^Token (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="850" y="415.677">seedT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="887" y="415.677">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="540" x2="582" y1="463.8001" y2="463.8001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="582" x2="582" y1="463.8001" y2="476.8001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="541" x2="582" y1="476.8001" y2="476.8001"/><polygon fill="#A80036" points="551,472.8001,541,476.8001,551,480.8001,547,476.8001" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="547" y="458.2771">Generate random nonce -&gt; (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="710" y="458.2771">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="717" y="458.2771">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="540" x2="582" y1="506.4001" y2="506.4001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="582" x2="582" y1="506.4001" y2="519.4001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="541" x2="582" y1="519.4001" y2="519.4001"/><polygon fill="#A80036" points="551,515.4001,541,519.4001,551,523.4001,547,519.4001" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="547" y="500.8771">Encrypt (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="600" y="500.8771">T</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="608" y="500.8771">|</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="611" y="500.8771">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="618" y="500.8771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="626" y="500.8771">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="633" y="500.8771">) -&gt; (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="661" y="500.8771">tkEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="696" y="500.8771">)</text><polygon fill="#A80036" points="393,545.0001,383,549.0001,393,553.0001,389,549.0001" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="387" x2="539" y1="549.0001" y2="549.0001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="399" y="543.4771">Return (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="445" y="543.4771">tkEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="480" y="543.4771">)</text><polygon fill="#A80036" points="40,574.6001,30,578.6001,40,582.6001,36,578.6001" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="381" y1="578.6001" y2="578.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="46" y="573.0771">Return (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="92" y="573.0771">tkEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="127" y="573.0771">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="71" y1="608.2001" y2="608.2001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71" x2="71" y1="608.2001" y2="621.2001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="71" y1="621.2001" y2="621.2001"/><polygon fill="#A80036" points="40,617.2001,30,621.2001,40,625.2001,36,621.2001" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="36" y="602.6771">Decode(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="84" y="602.6771">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="91" y="602.6771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="99" y="602.6771">tkEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="134" y="602.6771">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="158" y="602.6771">t|k</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="71" y1="650.8001" y2="650.8001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71" x2="71" y1="650.8001" y2="663.8001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="71" y1="663.8001" y2="663.8001"/><polygon fill="#A80036" points="40,659.8001,30,663.8001,40,667.8001,36,663.8001" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="36" y="645.2771">Next call encrypts t as enc(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="196" y="645.2771">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="207" y="645.2771">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="219" y="645.2771">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="226" y="645.2771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="234" y="645.2771">t</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="238" y="645.2771">)</text><!--
@startuml
actor "Client" as client
participant "JSON-RPC API (if used)" as jsonrpc
participant "Internal Rust API" as rustapi
participant "Wallet Backend" as backend
== Open Wallet ==
client -> client: Encrypt password (**pw**) with DH shared secret **s** -> **pwEnc**
client -> jsonrpc: Open Wallet (**pwEnc**)
jsonrpc -> rustapi: Open Wallet (**pwEnc**)
rustapi -> rustapi: Decrypt (**pwEnc**, **s**) -> (**pw**)
rustapi -> rustapi: Generate Token (**t**)
rustapi -> backend: Open Wallet(**t**, **pw**)
backend -> backend: Decrypt seed(**pw**) -> **Seed**
backend -> backend: Store Seed^Token (**seedT**)
rustapi -> rustapi: Generate random nonce -> (**k**)
rustapi -> rustapi: Encrypt (**T**|**k**, **s**) -> (**tkEnc**)
rustapi -> jsonrpc: Return (**tkEnc**)
jsonrpc -> client: Return (**tkEnc**)
client -> client: Decode(**s**, **tkEnc**) -> **t|k**
client -> client: Next call encrypts t as enc(**s** + **k**, **t**)
@enduml

PlantUML version 1.2019.06(Fri May 24 18:10:25 IST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 12.0.1+12
Operating System: Linux
OS Version: 5.1.11-arch1-1-ARCH
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>