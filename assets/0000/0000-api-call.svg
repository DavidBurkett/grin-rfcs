<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1089px" preserveAspectRatio="none" style="width:1203px;height:1089px;" version="1.1" viewBox="0 0 1203 1089" width="1203px" zoomAndPan="magnify"><defs><filter height="300%" id="f1sm4bum64ilax" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="29" x2="29" y1="86.7999" y2="1001.2003"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="361.5" x2="361.5" y1="86.7999" y2="1001.2003"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="558.5" x2="558.5" y1="86.7999" y2="1001.2003"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1001" x2="1001" y1="86.7999" y2="1001.2003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="8" y="83.0059">Client</text><ellipse cx="29" cy="13" fill="#FEFECE" filter="url(#f1sm4bum64ilax)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M29,21 L29,48 M16,29 L42,29 M29,48 L16,63 M29,48 L42,63 " fill="none" filter="url(#f1sm4bum64ilax)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="8" y="1013.2062">Client</text><ellipse cx="29" cy="1027.0002" fill="#FEFECE" filter="url(#f1sm4bum64ilax)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M29,1035.0002 L29,1062.0002 M16,1043.0002 L42,1043.0002 M29,1062.0002 L16,1077.0002 M29,1062.0002 L42,1077.0002 " fill="none" filter="url(#f1sm4bum64ilax)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1sm4bum64ilax)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="276.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="283.5" y="71.0059">JSON-RPC API (if used)</text><rect fill="#FEFECE" filter="url(#f1sm4bum64ilax)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="276.5" y="1000.2003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="283.5" y="1020.2062">JSON-RPC API (if used)</text><rect fill="#FEFECE" filter="url(#f1sm4bum64ilax)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="496.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="503.5" y="71.0059">Internal Rust API</text><rect fill="#FEFECE" filter="url(#f1sm4bum64ilax)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="496.5" y="1000.2003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="503.5" y="1020.2062">Internal Rust API</text><rect fill="#FEFECE" filter="url(#f1sm4bum64ilax)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="943" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="950" y="71.0059">Wallet Backend</text><rect fill="#FEFECE" filter="url(#f1sm4bum64ilax)" height="30.7999" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="943" y="1000.2003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="950" y="1020.2062">Wallet Backend</text><rect fill="#EEEEEE" filter="url(#f1sm4bum64ilax)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1188" x="3" y="117.5999"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1191" y1="117.5999" y2="117.5999"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1191" y1="120.5999" y2="120.5999"/><rect fill="#EEEEEE" filter="url(#f1sm4bum64ilax)" height="23.6" style="stroke: #000000; stroke-width: 2.0;" width="99" x="547.5" y="106.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="553.5" y="122.8769">Previous call</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="601" y1="162" y2="162"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="162" y2="175"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="560" x2="601" y1="175" y2="175"/><polygon fill="#A80036" points="570,171,560,175,570,179,566,175" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="566" y="156.477">Generate/store new nonce -&gt; (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="742" y="156.477">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="749" y="156.477">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="601" y1="204.6" y2="204.6"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="204.6" y2="217.6"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="560" x2="601" y1="217.6" y2="217.6"/><polygon fill="#A80036" points="570,213.6,560,217.6,570,221.6,566,217.6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="566" y="199.077">Encrypt any sensitive call result data (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="789" y="199.077">secret_data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="859" y="199.077">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="867" y="199.077">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="878" y="199.077">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="890" y="199.077">k_prev</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="931" y="199.077">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="955" y="199.077">sdEnc</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="601" y1="247.2" y2="247.2"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="247.2" y2="260.2"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="560" x2="601" y1="260.2" y2="260.2"/><polygon fill="#A80036" points="570,256.2,560,260.2,570,264.2,566,260.2" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="566" y="241.677">Encrypt (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="619" y="241.677">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="626" y="241.677">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="634" y="241.677">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="645" y="241.677">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="657" y="241.677">k_prev</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="698" y="241.677">) -&gt; (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="726" y="241.677">kEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="757" y="241.677">)</text><path d="M240,232.1 L240,257.1 L550,257.1 L550,242.1 L540,232.1 L240,232.1 " fill="#FBFB77" filter="url(#f1sm4bum64ilax)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M540,232.1 L540,242.1 L550,242.1 L540,232.1 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="246" y="249.177">'open_wallet' returns</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="366" y="249.177">t|k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="381" y="249.177">, all other api calls return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="528" y="249.177">k</text><polygon fill="#A80036" points="373,285.8,363,289.8,373,293.8,369,289.8" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="367" x2="558" y1="289.8" y2="289.8"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="379" y="284.277">Return (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="425" y="284.277">kEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="456" y="284.277">, Result,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="509" y="284.277">sdEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="548" y="284.277">)</text><polygon fill="#A80036" points="40,315.4,30,319.4,40,323.4,36,319.4" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="361" y1="319.4" y2="319.4"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="46" y="313.877">Return (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="92" y="313.877">kEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="123" y="313.877">, Result,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="176" y="313.877">sdEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="215" y="313.877">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="71" y1="349" y2="349"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71" x2="71" y1="349" y2="362"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="71" y1="362" y2="362"/><polygon fill="#A80036" points="40,358,30,362,40,366,36,362" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="36" y="343.477">decrypt(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="83" y="343.477">kEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="114" y="343.477">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="122" y="343.477">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="133" y="343.477">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="145" y="343.477">k_prev</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="186" y="343.477">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="210" y="343.477">k</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="71" y1="391.6" y2="391.6"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71" x2="71" y1="391.6" y2="404.6"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="71" y1="404.6" y2="404.6"/><polygon fill="#A80036" points="40,400.6,30,404.6,40,408.6,36,404.6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="36" y="386.077">decrypt(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="83" y="386.077">sdEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="122" y="386.077">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="130" y="386.077">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="141" y="386.077">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="153" y="386.077">k_prev</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="194" y="386.077">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="218" y="386.077">secret_data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="71" y1="434.2001" y2="434.2001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71" x2="71" y1="434.2001" y2="447.2001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="71" y1="447.2001" y2="447.2001"/><polygon fill="#A80036" points="40,443.2001,30,447.2001,40,451.2001,36,447.2001" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="36" y="428.677">Next call encrypts t as enc(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="196" y="428.677">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="207" y="428.677">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="219" y="428.677">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="226" y="428.677">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="234" y="428.677">t</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="238" y="428.677">)</text><rect fill="#EEEEEE" filter="url(#f1sm4bum64ilax)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1188" x="3" y="476.0001"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1191" y1="476.0001" y2="476.0001"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1191" y1="479.0001" y2="479.0001"/><rect fill="#EEEEEE" filter="url(#f1sm4bum64ilax)" height="23.6" style="stroke: #000000; stroke-width: 2.0;" width="68" x="563" y="465.2001"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="50" x="569" y="481.2771">API Call</text><polygon fill="#A80036" points="350,516.4001,360,520.4001,350,524.4001,354,520.4001" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="356" y1="520.4001" y2="520.4001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="36" y="514.8771">Encrypt token (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="125" y="514.8771">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="136" y="514.8771">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="148" y="514.8771">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="155" y="514.8771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="163" y="514.8771">t</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="167" y="514.8771">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="191" y="514.8771">tEnc</text><polygon fill="#A80036" points="350,546.0001,360,550.0001,350,554.0001,354,550.0001" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="356" y1="550.0001" y2="550.0001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="36" y="544.4771">store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="69" y="544.4771">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="80" y="544.4771">as</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="98" y="544.4771">k_prev</text><polygon fill="#A80036" points="350,575.6001,360,579.6001,350,583.6001,354,579.6001" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="356" y1="579.6001" y2="579.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="36" y="574.0771">Encrypt sensitive data (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="174" y="574.0771">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="185" y="574.0771">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="197" y="574.0771">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="204" y="574.0771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="212" y="574.0771">secret_data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="282" y="574.0771">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="306" y="574.0771">sdEnc</text><polygon fill="#A80036" points="350,605.2001,360,609.2001,350,613.2001,354,609.2001" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="29" x2="356" y1="609.2001" y2="609.2001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="36" y="603.6771">api_call(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="84" y="603.6771">tEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="112" y="603.6771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="120" y="603.6771">sdEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="159" y="603.6771">)</text><polygon fill="#A80036" points="547,634.8001,557,638.8001,547,642.8001,551,638.8001" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="362" x2="553" y1="638.8001" y2="638.8001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="369" y="633.2771">api_call(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="417" y="633.2771">tEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="445" y="633.2771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="453" y="633.2771">sdEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="492" y="633.2771">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="601" y1="668.4001" y2="668.4001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="668.4001" y2="681.4001"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="560" x2="601" y1="681.4001" y2="681.4001"/><polygon fill="#A80036" points="570,677.4001,560,681.4001,570,685.4001,566,681.4001" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="566" y="662.8771">dec(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="591" y="662.8771">tEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="619" y="662.8771">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="627" y="662.8771">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="638" y="662.8771">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="650" y="662.8771">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="657" y="662.8771">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="681" y="662.8771">T</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="601" y1="711.0002" y2="711.0002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="711.0002" y2="724.0002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="560" x2="601" y1="724.0002" y2="724.0002"/><polygon fill="#A80036" points="570,720.0002,560,724.0002,570,728.0002,566,724.0002" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="566" y="705.4772">dec(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="591" y="705.4772">sdEnc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="630" y="705.4772">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="638" y="705.4772">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="649" y="705.4772">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="661" y="705.4772">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="668" y="705.4772">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="692" y="705.4772">secret_data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="601" y1="753.6002" y2="753.6002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="753.6002" y2="766.6002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="560" x2="601" y1="766.6002" y2="766.6002"/><polygon fill="#A80036" points="570,762.6002,560,766.6002,570,770.6002,566,766.6002" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="566" y="748.0772">store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="599" y="748.0772">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="610" y="748.0772">as</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="628" y="748.0772">k_prev</text><polygon fill="#A80036" points="989,792.2002,999,796.2002,989,800.2002,993,796.2002" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="995" y1="796.2002" y2="796.2002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="566" y="790.6772">decode_seed(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="647" y="790.6772">T</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="655" y="790.6772">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1001" x2="1043" y1="825.8002" y2="825.8002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1043" x2="1043" y1="825.8002" y2="838.8002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1002" x2="1043" y1="838.8002" y2="838.8002"/><polygon fill="#A80036" points="1012,834.8002,1002,838.8002,1012,842.8002,1008,838.8002" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1008" y="820.2772">calculate (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="1068" y="820.2772">T</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="6" x="1080" y="820.2772">^</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="1090" y="820.2772">SeedT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="1129" y="820.2772">) -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="1153" y="820.2772">Seed</text><polygon fill="#A80036" points="989,864.4002,999,868.4002,989,872.4002,993,868.4002" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="995" y1="868.4002" y2="868.4002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="566" y="862.8772">Further API calls</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1001" x2="1043" y1="898.0002" y2="898.0002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1043" x2="1043" y1="898.0002" y2="911.0002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1002" x2="1043" y1="911.0002" y2="911.0002"/><polygon fill="#A80036" points="1012,907.0002,1002,911.0002,1012,915.0002,1008,911.0002" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="1008" y="892.4772">Drop</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="1039" y="892.4772">Seed</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="559" x2="601" y1="940.6002" y2="940.6002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="940.6002" y2="953.6002"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="560" x2="601" y1="953.6002" y2="953.6002"/><polygon fill="#A80036" points="570,949.6002,560,953.6002,570,957.6002,566,953.6002" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="566" y="935.0772">Generate/store new nonce -&gt; (</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="742" y="935.0772">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="749" y="935.0772">)</text><polygon fill="#A80036" points="40,979.2003,30,983.2003,40,987.2003,36,983.2003" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="558" y1="983.2003" y2="983.2003"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="46" y="977.6773">(Proceed as per 'previous call' section above)</text><!--
@startuml
actor "Client" as client
participant "JSON-RPC API (if used)" as jsonrpc
participant "Internal Rust API" as rustapi
participant "Wallet Backend" as backend

== Previous call ==

rustapi -> rustapi: Generate/store new nonce -> (**k**)
rustapi -> rustapi: Encrypt any sensitive call result data (**secret_data**, **s** + **k_prev**) -> **sdEnc**
rustapi -> rustapi: Encrypt (**k**, **s** + **k_prev**) -> (**kEnc**)
note left: 'open_wallet' returns **t|k**, all other api calls return **k**
rustapi -> jsonrpc: Return (**kEnc**, Result, **sdEnc**)
jsonrpc -> client: Return (**kEnc**, Result, **sdEnc**)
client -> client: decrypt(**kEnc**, **s** + **k_prev**) -> **k**
client -> client: decrypt(**sdEnc**, **s** + **k_prev**) -> **secret_data**
client -> client: Next call encrypts t as enc(**s** + **k**, **t**)

== API Call ==
client -> jsonrpc: Encrypt token (**s** + **k**, **t**) -> **tEnc**
client -> jsonrpc: store **k** as **k_prev**
client -> jsonrpc: Encrypt sensitive data (**s** + **k**, **secret_data**) -> **sdEnc**
client -> jsonrpc: api_call(**tEnc**, **sdEnc**)
jsonrpc -> rustapi: api_call(**tEnc**, **sdEnc**)
rustapi -> rustapi: dec(**tEnc**, **s** + **k**) -> **T**
rustapi -> rustapi: dec(**sdEnc**, **s** + **k**) -> **secret_data**
rustapi -> rustapi: store **k** as **k_prev**
rustapi -> backend: decode_seed(**T**)
backend -> backend: calculate (**T** ^ **SeedT**) -> **Seed**
rustapi -> backend: Further API calls
backend -> backend: Drop **Seed**
rustapi -> rustapi: Generate/store new nonce -> (**k**)
rustapi -> client: (Proceed as per 'previous call' section above)
@enduml

PlantUML version 1.2019.06(Fri May 24 18:10:25 IST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 12.0.1+12
Operating System: Linux
OS Version: 5.1.11-arch1-1-ARCH
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>